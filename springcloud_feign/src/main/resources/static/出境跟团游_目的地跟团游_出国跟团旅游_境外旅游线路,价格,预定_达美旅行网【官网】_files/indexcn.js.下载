require(["/pc/js/require/config.js?v="+require_ver.version],function(){require(["pikaDay","commonLazy","commonTips","pagination","commonBox"],function(a,e,t,n,i){function s(a,e,t){$.post(newIndexlUrl,{no:e,type:t},function(e){a.next("span").text(e.data.useful)})}function l(a){a.page="";var e=$.extend(!0,{},a);b.deleteKey(e),location=location.href.split("?")[0]+"?"+decodeURIComponent($.param(e))}$(".des").on("click","img",function(a){a.preventDefault(),-1!==$(this)[0].src.indexOf("top.png")?($(this).attr("src","/pc/img/list/down.png"),$(this).attr("data-tag","/pc/img/list/top.png"),$(this).prev().removeClass("expand").addClass("collapse")):($(this).attr("src","/pc/img/list/top.png"),$(this).attr("data-tag","/pc/img/list/down.png"),$(this).prev().removeClass("collapse").addClass("expand"))});var r="null"!=$allViewspots?JSON.parse($allViewspots.replace(/\s+/g,"")).options:{},o="null"!=$allDestination?JSON.parse($allDestination.replace(/\s+/g,"")).options:{},d="null"!=$allDeparting_city?JSON.parse($allDeparting_city.replace(/\s+/g,"")).options:{},c="null"!=$allend_city?JSON.parse($allend_city.replace(/\s+/g,"")).options:{},p={};p.destination=o,p.viewspots=r,p.departing_city=d,p.end_city=c;var m=/^[A-Za-z]+$/,h="";for(var v in p){var u=[],f="";if(p[v]){for(var g=0,_=p[v].length;g<_;g++)-1==u.indexOf(p[v][g].zm)&&(m.test(p[v][g].zm)?u.push(p[v][g].zm):-1==u.indexOf("#")&&u.push("#"));u.sort(),"#"==u[0]&&(u=u.slice(1)).push("#");for(var C=0,k=u.length;C<k;C++)f+="<li data-tag="+u[C]+">"+u[C]+"</li>";$(".tags-"+v+" .search_box").before(f)}}var y=[];$("ul.filter-list").find("li").each(function(a,e){var t=$(e);1==t.data("recommend")&&y.push({name:t,rank:t.data("rank")})}),y.sort(function(a,e){var t=a.rank,n=e.rank;return t<n?1:t>n?-1:0}),y.map(function(a,e){var t=$(a.name);h+=0==e||3==e?"<li data-alias="+t.data("alias")+" data-name="+t.data("name")+" data-pname="+t.data("pname")+" data-id="+t.data("id")+' ><span id="gtm-screen" data-screen='+t.attr("data-pname")+" title="+t.data("name")+">"+t.data("name")+'</span><img src="/pc/img/list/rehot.png"></li>':2==e?"<li data-alias="+t.data("alias")+" data-name="+t.data("name")+" data-pname="+t.data("pname")+" data-id="+t.data("id")+' ><span id="gtm-screen" data-screen='+t.attr("data-pname")+" title="+t.data("name")+">"+t.data("name")+'</span><img src="/pc/img/list/renew.png"></li>':"<li data-alias="+t.data("alias")+" data-name="+t.data("name")+" data-pname="+t.data("pname")+" data-id="+t.data("id")+' ><span id="gtm-screen" data-screen='+t.attr("data-pname")+" title="+t.data("name")+">"+t.data("name")+"</span></li>"}),$("ul.recommend_selected").append(h),$(".tags li").on("click",function(){var a=$(this),e=a.data("tag");a.addClass("current").siblings().removeClass("current"),function(a,e){$(".taps."+e+" li").each(function(e,t){"hot"===a?$(t).show():a===$(t).data("zm")?$(t).show():$(t).hide(),"#"!==a||m.test($(t).data("zm"))||$(t).show()})}(e,a.parent("ul").data("key"))});var D={},b={deleteKey:function(a){for(var e in a)"object"==typeof a[e]?b.deleteKey(a[e]):""==a[e]&&delete a[e]},delFristChar:function(a){return"0"===a.charAt(0)?a.substr(1,1):a},sortedData:function(a){a.forEach(function(a,e){var t=a.departing_date.split("-"),n=t[0];if(_innerMonth=b.delFristChar(t[1]),_innerDay=b.delFristChar(t[2]),D[n]||(D[n]={}),D[n][_innerMonth]||(D[n][_innerMonth]={}),D[n][_innerMonth][_innerDay]){var i=D[n][_innerMonth][_innerDay];D[n][_innerMonth][_innerDay]=i.price>a.price?a:i}else D[n][_innerMonth][_innerDay]=a})},checkDate:function(a){var e=new Date(a);_eleDateyear=e.getFullYear(),_eleDatemon=e.getMonth()+1,_eleDateday=e.getDate();var t=D[_eleDateyear]&&D[_eleDateyear][_eleDatemon]||{};return t[_eleDateday]&&t[_eleDateday].price||""}},x={rank:"",price:"",key:""};$(".filter_con").find("label").each(function(a,e){var t=$(e).data("alias");void 0!==t&&(x[t]="")}),$(".lookgroup").length&&($(".lookgroup").on("click",function(a){var e,t=$(this),n=t.attr("data-id"),i=_priceurl+"?product_id="+n;t.hasClass("hasshow")||(t.addClass("hasshow"),$.get(i,function(a){a.code?(e=a.data,b.sortedData(e)):e=[],t.pikaday({position:"bottom right",defaultDate:e.length?new Date(e[0].departing_date):new Date,dayInfo:e,disableDayFn:function(a){if(!b.checkDate(a))return!0},onSelect:function(a){window.open(t.data("link")+"?from=list#booking-cart")}}).pikaday("show")}))}),$("a.compare").on("click",function(a){a.preventDefault();var e=$(this);i.compare({contain:e,url:$compareUrl,no:e.data("no")})})),$(".gmFive").on("click",function(){var a=$(this).find(".gmFiveIcon"),e=a.data("id");a.hasClass("on")?(s(a,e,"desc"),a.removeClass("on")):(s(a,e,"plus"),a.addClass("on"))}),$(".filter-list li,.taps li,.recommend_selected li").on("click",function(a){a.preventDefault();var e=$(this),t=e.data("name"),n=e.data("pname"),i=e.data("alias"),s=e.parent().data("sign"),r=e.data("id");if($("li[data-id="+r+"][data-alias="+i+"]").hasClass("on")){$("li[data-id="+r+"][data-alias="+i+"]").removeClass("on"),$("#all_sel_opts").find("a[data-id="+r+"][data-alias="+i+"]").parent("li").remove();var o=x[i].split(",");o.splice($.inArray(String(r),o),1),x[i]=o.join(","),e.siblings(".is_morechoose").hasClass("hide")&&l(x)}else $("li[data-id="+r+"][data-alias="+i+"]").addClass("on"),void 0!=x[i]?x[i]+=","+r:x[i]=""+r,(e.siblings(".is_morechoose").hasClass("hide")||e.parent().hasClass("is-recommend"))&&($("#all_sel_opts").append('<li><span class="attriTitle">'+n+'</span><span class="attri">'+t+'<a href="javascript:;" class="opt-remove" data-alias='+i+" data-id="+r+" data-sign="+s+'><i class="iconfont icon-close"></i></a></span></li>'),l(x))}),$(".search_box a").on("click",function(a){a.preventDefault();var e=$(this).prev().val().toUpperCase(),n=($(this).parent().data("key"),$(this).parent().data("alert")),i=$(this).parent().parent().siblings(".tab_box").find("li");if(i&&(i.each(function(a,t){$(this).addClass("hidex");$(this).data("name").toUpperCase().indexOf(e)>=0&&$(this).removeClass("hidex")}),i.length==$(this).parent().parent().siblings(".tab_box").find("li.hidex").length)){var s={contentHtml:"没有查询到"+n,closeBtn:!0};t.Walert(s)}}),$("span.more_confirm").on("click",function(a){a.preventDefault(),l(x)}),$("span.more_cancel").on("click",function(a){a.preventDefault();var e=$(this);x[e.data("alias")]="",l(x)}),$("#all_sel_opts").on("click","a",function(a){a.preventDefault();var e=$(this).data("alias");x[e]="",l(x)}),$("a.empty_sel").on("click",function(a){a.preventDefault(),$("div.filter_con").find("li").removeClass("on"),$("ul#all_sel_opts").empty();for(var e in x)x[e]="";l(x)}),$("div.keywordsearch button").on("click",function(a){var e=$(this),t=$.trim(e.prev("input").val());t&&(x.key=t,l(x))}),$("div.sort_menus li").on("click",function(a){a.preventDefault();var e=$(this),t=e.index();e.addClass("on").siblings().removeClass("on"),x.rank=t,4==t?e.children("i").hasClass("rotate")?(x.rank=5,e.children("i").removeClass("rotate")):e.children("i").addClass("rotate"):5==t?e.children("i").hasClass("rotate")?(x.rank=8,e.children("i").removeClass("rotate")):(x.rank=7,e.children("i").addClass("rotate")):e.nextAll(".rankprice").children("i").removeClass("rotate"),l(x)}),$("div.pricerank input").keyup(function(){var a=$(this),e=a.val();/^[0-9]*$/.test(e)?a.css({border:"1px solid #dadada"}):(a.css({border:"1px solid #f50"}),a.val(""))}),$("div.pricerank button").on("click",function(){var a=$("#minprice").val(),e=$("#maxprice").val();""==a&&""!=e?(x.price=","+e,l(x)):""!=a&&""==e?(x.price=a+",",l(x)):""!=a&&""!=e?(x.price=a+","+e,l(x)):(x.price="",l(x))}),handlerMonth=function(a){if(a)return"一月"==a||"二月"==a||"三月"==a?"(春季)":"四月"==a||"五月"==a||"六月"==a?"(夏季)":"七月"==a||"八月"==a||"九月"==a?"(秋季)":"十月"==a||"十一月"==a||"十二月"==a?"(冬季)":""},function(){var a={};location.search&&"?index"!==location.search&&location.search.slice(1).replace(/\?.+/g,"").split("&").forEach(function(e){var t=e.split("=");a[t[0]]=decodeURIComponent(t[1])}),x=$.extend(!0,{},a),$("div.sort_menus li").eq(0).addClass("on").siblings().removeClass("on"),$("div.filter_con").find("li").removeClass("on"),$("ul#all_sel_opts").empty();for(var e in a){for(var t="",n=0,i=a[e].split(",").length;n<i;n++){$("li[data-id="+a[e].split(",")[n]+"][data-alias="+e+"]").addClass("on");var s=$("li.on[data-id="+a[e].split(",")[n]+"][data-alias="+e+"]");"rank"!=e&&"page"!=e&&"price"!=e&&""!=e&&"undefined"!=a[e].split(",")[n]&&void 0!=s.data("name")&&(t+=""==t?s.data("name"):","+s.data("name"))}if("rank"==e&&($("div.sort_menus li").eq(a[e]).addClass("on").siblings().removeClass("on"),4==a[e]?($("div.sort_menus li").eq(4).addClass("on").siblings().removeClass("on"),$("div.sort_menus li").eq(4).children("i").addClass("rotate")):5==a[e]?($("div.sort_menus li").eq(4).addClass("on").siblings().removeClass("on"),$("div.sort_menus li").eq(4).children("i").removeClass("rotate")):7==a[e]?($("div.sort_menus li").eq(5).addClass("on").siblings().removeClass("on"),$("div.sort_menus li").eq(5).children("i").addClass("rotate")):8==a[e]&&($("div.sort_menus li").eq(5).addClass("on").siblings().removeClass("on"),$("div.sort_menus li").eq(5).children("i").removeClass("rotate"))),a.price){var l=a.price.split(",");$("#minprice").val(l[0]),$("#maxprice").val(l[1])}if("rank"!=e&&"page"!=e&&"price"!=e&&""!=e&&"undefined"!=a[e].split(",")[n]&&void 0!=s.data("name")){var r=t;t.length>12&&(t=t.substring(0,12)+"..."),$("#all_sel_opts").append('<li><span class="attriTitle">'+s.data("pname")+'</span><span class="attri" title='+r+">"+t+handlerMonth(t)+'<a href="javascript:;" class="opt-remove" data-alias='+e+'><i class="iconfont icon-close"></i></a></span></li>')}}var o=$(".showchoosed");o.find("li").length?o.show():o.hide()}()})});