require(["/pc/js/require/config.js?v="+require_ver.version],function(){require(["commonBox","commonTips","pikaDay","carousel","qrcode","tabs","navScroll"],function(e,t,n,o,i,a,r){function c(e){for(var t in $personPrice)if(e===$personPrice[t].number)return $personPrice[t];return"重新询价"}function s(e,t,n){$.post(newIndexlUrl,{no:t,type:n},function(t){e.next("span").text(t.data.useful)},"json")}function s(e,t,n){$.post(newIndexlUrl,{no:t,type:n},function(t){e.next("span").text(t.data.useful)},"json")}function l(){U&&(clearInterval(U),U=null)}function d(e,n){if(!U){var o=60;U=setInterval(function(){o--,$(n).html("重新发送("+o+"S)"),0==o&&(clearInterval(U),U=null,$(n).html("获取验证码"))},1e3);var i=$.trim(e.val());$.post(validateUrl,{action:1,phone:i},function(e){if(7==e.code){n={flagicon:"icon-success",color:"#41d090",contentHtml:e.info,closeBtn:!1};t.Walert(n)}else{var n={contentHtml:e.info,closeBtn:!1};t.Walert(n)}},"json")}}function l(){U&&(clearInterval(U),U=null)}!function(){if($personPrice[0]){var e=$personPrice[0],t=$personPrice[0].adult_price;for(var n in $personPrice)(Number($personPrice[n].adult_price)<Number(t)||Number($personPrice[n].adult_price)==Number(t))&&(t=$personPrice[n].adult_price,e=$personPrice[n]);$(".rightBox .num_show").val(e.number),$(".rightBox .price span").text(e.adult_price),$(".rightBox .totalPrice span").text(e.adult_price*e.number)}}(),$(".clearSelect").hide(),$("#startaddress").Tabs(),$("#editStartCity").Tabs(),$("#travelStartCity").Tabs();var u=$(".rightBox .price span"),p=$(".rightBox .totalPrice span");$("span.btn_pluse").on("click",function(){var e=$(this),t=e.prev("input").val();t++,e.prev("input").val(t)}),$("span.btn_desc").on("click",function(){var e=$(this),t=e.next("input").val();--t<=1&&(t=1),e.next("input").val(t)}),$(".rightBox .person_num").on("click","span.btn",function(e){var t=$(".rightBox .person_num .num_show").val(),n=c(t);"重新询价"==n?(u.text("----"),p.text("重新询价")):function(e,t){u.text(t),p.text((e*t).toFixed(2))}(t,n.adult_price)}),$(".edit .person_num").on("click","span.btn",function(){var e=$(".edit .person_num .num_show").val(),t=c(e);"重新询价"==t?$(".diy-tel-box .totalPrice span").text("重新询价"):$(".diy-tel-box .totalPrice span").text((e*t.adult_price).toFixed(2))}),$("#diyerInfo").on("click","li .gmFive",function(e){e.preventDefault();var t=$(this).find(".gmFiveIcon"),n=t.data("id");t.hasClass("on")?(s(t,n,"desc"),t.removeClass("on")):(s(t,n,"plus"),t.addClass("on"))}),$("#diyerInfo").on("click",".closeBtn",function(){$(".diyModals").hide(),$(".shadow-box").hide()});$(".gmFive").on("click",function(){var e=$(this).find(".gmFiveIcon"),t=e.data("id");e.hasClass("on")?(s(e,t,"desc"),e.removeClass("on")):(s(e,t,"plus"),e.addClass("on"))}),$("#start-date").pikaday({onSelect:function(e){$("span.extraUsetime").text(e)}}),$(".editStartTime").pikaday({onSelect:function(e){$("span.extraUsetime").text(e)}}),$("#travel-person").pikaday({onSelect:function(e){$("span.extraUsetime").text(e)}}),$("input[name='减少的城市']").on("click",function(e){$(this).is(":checked")?$(this).next().addClass("checked"):$(this).next().removeClass("checked")});$("span.collect").on("click",function(){var t={contain:$(this),product_id:$productId};e.collect(t)});var h=-1!==window.location.origin.indexOf("hydegroup")?"/pc/img/hyde/qrlogo.png":"/pc/img/common/travelLogo.png";$("#code").qrcode({width:100,height:100,src:h,text:location.href+"?mobile-PCQR"}),$(".scan_code").hover(function(){$(".qrcode").show()},function(){$(".qrcode").hide()}),$("#recommend-products").Tabs();var m=$(".scroll_nav"),f=$(".scroll_con").children(".scroll-part");$daysNav=$(".day-container"),nav_scroll=new r.Nav,days_Scroll=new r.Days,nav_scroll.init(m,f,function(){days_Scroll.init($daysNav)});var v=$("div.tour-brief-wrapper"),_=v.find("ul.tour-brief-list"),x=v.find("ul.tour-brief-list li");tourli_carousel=new r.carousel({prev:"brief-prev",next:"brief-next",hiddenWrap:"tour-brief-inner",step:8}),tourli_carousel.init(v,_,x),getPicInfo=function(e){t.loadShow.init(),$.get(e,function(e){$("#picInfo").html(e).show(),t.loadShow.close(),$("#picInfo").show(),$(".slideshow").Carousels({auto:3e3})})};var y,b="/product/_viewspot.html";$(".pictures .img-list .tour_imgli").on("click",function(){$(".shadow-box").show(),y=$(this);var e=$(this).data("id"),t=$(this).data("type"),n=$(this).parents(".daysTarget").attr("day-offset"),o=b+"?type="+t+"&viewspot_id="+e+"&trip_day="+n;getPicInfo(o)}),$(".view_tour_info .recommend span.viewspot").on("click",function(){var e=$(this).data("id"),t=$(this).data("type"),n=t+e;y=$("#"+n);var o=$(this).parents(".daysTarget").attr("day-offset"),i=b+"?type="+t+"&viewspot_id="+e+"&trip_day="+o;$(".shadow-box").show(),getPicInfo(i)}),$("#picInfo").on("click",".slide_btn",function(e){e.preventDefault();var t,n,o,i,a=$(this);o=y.parents(".daysTarget").attr("day-offset"),a.hasClass("slide_btn_prev")?y.prev().length?(t=y.prev().data("id"),i=y.prev().data("type"),y=y.prev(),n=b+"?viewspot_id="+t+"&trip_day="+o+"&type="+i,getPicInfo(n)):(t=y.parent().children().last().data("id"),i=(y=y.parent().children().last()).parent().children().last().data("type"),n=b+"?viewspot_id="+t+"&trip_day="+o+"&type="+i,getPicInfo(n)):a.hasClass("slide_btn_next")&&(y.next().length?(t=y.next().data("id"),i=y.next().data("type"),y=y.next(),n=b+"?viewspot_id="+t+"&trip_day="+o+"&type="+i,getPicInfo(n)):(t=y.parent().children().first().data("id"),i=(y=y.parent().children().first()).parent().children().first().data("type"),n=b+"?viewspot_id="+t+"&trip_day="+o+"&type="+i,getPicInfo(n)))}),$("#picInfo").on("click",".icon-close",function(){$("#picInfo").hide(),$(".shadow-box").hide()}),$(".send_no").click(function(e){$(".demand_box").hide(),$(".diy-tel-box").hide()});var w={type:14,url:window.location.href,action:2,contact:$userName,phone:$userPhone,code:""};$(".made").click(function(e){if(e.preventDefault(),handlerInputVal()){$(".show").show(),$(".edit").hide();var t=$(".rightBox form").serializeObject();$(".madeStartTime").html(t["出发日期"]),$(".madeStartCity").html(t["出发城市"]),$(".madePersonNum").html(t["人数"]?$(".person_num input").val():""),$(".madeTotlePrice").html($(".rightBox .totalPrice span").text()),$(".formdate_footer a").html("编辑信息"),$(".edit .person_num .num_show").val(t["人数"]?$(".person_num input").val():1),$.extend(w,t),w.city=t["出发城市"]}else $(".formdate_footer a").html("编辑完成"),$(".edit .person_num .num_show").val($(".rightBox .num_show").val()),$(".show").hide(),$(".edit").show();$(".diy-tel-box").show()}),$(".trip").click(function(e){e.preventDefault(),handlerInputVal(),$(".demand_box").show()}),$(".tel_close").click(function(){$(".diy-tel-box").hide()}),$(".demand_close").click(function(){$(".demand_box").hide()}),handlerInputVal=function(){var e=$("#start-date").val(),t=$(".startaddress").val();return!(!e&&!t)},$(".formdate_footer a").click(function(e){e.preventDefault();"编辑信息"==$(this).html()?($(this).html("编辑完成"),$(".show").hide(),$(".edit").show()):($(this).html("编辑信息"),$(".edit").hide(),$(".show").show(),$.extend(w,$(".edit").serializeObject()),w["总价"]=w["人数"],w.city=w["出发城市"],w["人数"]=$(".edit .editPersonNum input").val(),$(".formdate .show .madeStartTime").html(w["出发日期"]),$(".formdate .show .madeStartCity").html(w["出发城市"]),$(".formdate .show .madePersonNum").html(w["人数"]))}),$(".edit select.editPersonNum").change(function(){$(this).val()&&"其他"!=$(this).val()?$(".modal_content .totalPrice span").html($(this).val()):$(".modal_content .totalPrice span").html("重新询价")}),$(".diy-tel-box .send_demand").click(function(){if(valiDiySussFun()||$userPhone||$userName){var e=getMadeUserData(".demand>form");w.code=e.code,w.contact=e.contact,w.email=e.email,w.phone=e.phone,w.wx=e.wx,w["更多需求"]=$("#demands").val(),$(".diy-tel-box").hide(),postFormData(w)}else{t.Walert({contentHtml:"正确填写联系人、手机号、验证码",closeBtn:!1})}}),trimPostData={type:14,url:window.location.href,action:2,contact:$userName,phone:$userPhone,code:""},$(".demand_box .send_demand").click(function(){var e=$(".demand_form").serializeObject();if($.extend(trimPostData,e),valiTrimSussFun()||$userPhone||$userName)$(".demand_box").hide(),trimPostData["减少的城市"]=e["减少的城市"].join(""),postFormData(trimPostData);else{t.Walert({contentHtml:"正确填写联系人、手机号、验证码",closeBtn:!1})}}),getMadeUserData=function(e){if(e){return $(e).serializeObject()}};var g=$('.demand input[name="contact"]'),P=$('.demand input[name="phone"]'),k=$('.demand input[name="code"]'),B=!1,I=!1,S=!1;valiDiySussFun=function(){return!!(B&&I&&S)},g.blur(function(){B=valiFun(g)}),P.blur(function(){I=valiFun(P)}),k.blur(function(){var e=$(this).val(),n=P.val();e&&$.post(validateUrl,{type:"phone",phone:n,code:e,action:2},function(e){if(5==e.code)S=!0,k.css("border-color","#d2d2d2");else{S=!1,k.css("border-color","red");var n={contentHtml:e.info,closeBtn:!1};t.Walert(n)}},"json")}),valiFun=function(e){return e.val()?(e.css("border-color","#dbdbdb"),!0):(e.css("border-color","red"),!1)};$(".demand .isLogin a").click(function(){I?d(P,this):P.css("border-color","red")});U=null;parseParam=function(e,t){var n="";return e instanceof String||e instanceof Number||e instanceof Boolean?n+="&"+t+"="+encodeURIComponent(e):$.each(e,function(o){var i=null==t?o:t+(e instanceof Array?"["+o+"]":"."+o);n+="&"+parseParam(this,i)}),n.substr(1)},postFormData=function(e){t.loadShow.init(),$.ajax({type:"POST",url:validateUrl,data:e,async:!1,error:function(e){alert("Connection error")},success:function(e){if(5==e.code){$(".demand >form")[0].reset(),$(".demand_form")[0].reset(),$(".edit")[0].reset(),t.loadShow.close();n={diyBtns:["查看","返回首页"],diyUrl:["/my/diy.html","/"]};t.Galert(n),l()}else{var n={contentHtml:e.info,closeBtn:!1};t.Walert(n)}}})};var C=$('.demand_form .isLogin input[name="contact"]'),D=$('.demand_form .isLogin input[name="phone"]'),F=$('.demand_form .isLogin input[name="code"]'),N=!1,T=!1,j=!1;valiTrimSussFun=function(){return!!(N&&T&&j)},C.blur(function(){N=valiFun(C)}),D.blur(function(){T=valiFun(D)}),F.blur(function(){var e=$(this).val(),n=D.val();e&&$.post(validateUrl,{type:"phone",phone:n,code:e,action:2},function(e){if(5==e.code)j=!0,F.css("border-color","#d2d2d2");else{j=!1,F.css("border-color","red");var n={contentHtml:e.info,closeBtn:!1};t.Walert(n)}},"json")}),$(".contactWay .isLogin a").click(function(){T?d(D,this):D.css("border-color","red")});var U=null;$(".send_rq").click(function(){var e=$(".phonenum").val();if(/^1\d{10}$/.test(e)){var n={action:"phone",url:location.href,phone:e,remark:$("#more").val(),service:[]};$.post("/index/_right.html",n,function(e){1==e.code?($("div.diy-tel-box").addClass("hide"),t.Walert({flagicon:"icon-success",closeBtn:!1,contentHtml:"提交成功"})):t.Walert({closeBtn:!1,contentHtml:"提交失败"})})}else t.Walert({closeBtn:!1,contentHtml:"请填写正确手机号"})});var W={type:"",price:""};$(".recommendBox .leftBox .typeBox").click(function(){$(this).addClass("active").siblings().removeClass("active");var e=$(this).data("price");$("#showRecommendPrice").text(e),W.type=$(this).text(),W.price=e}),$(".goRequest").click(function(){var e=$(this).data("url");W.type?(e+="&fromDiy="+W.type+"/"+W.price,window.open(e)):t.Walert({closeBtn:!1,contentHtml:"请先选择类型"})}),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e}})});