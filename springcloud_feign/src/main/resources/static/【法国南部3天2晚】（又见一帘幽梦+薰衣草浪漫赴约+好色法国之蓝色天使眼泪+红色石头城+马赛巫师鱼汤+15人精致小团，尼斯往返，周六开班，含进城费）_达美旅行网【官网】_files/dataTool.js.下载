define(["qrcode","pagination","commonTips","commonBox","navScroll","poptips","cookie"],function(t,e,n,i,a,o,r){var c={tour:{departing_date:"",product_id:$productId,adult:"1",child:"0",cost:"",price:"---",save:"---",hotel:{package_id:"",rooms:[{adult:1,child:0,share_price:0}]},traveling:{viewspots:[{package_id:"",viewspot:"",addr:""}]},normal:{package_id:""},optional:{packages:[{package_id:"",packageitem_id:"",addr:""}]},addrs:{pick_up:{id:"",addr:""},see_off:{id:"",addr:""},gather_place:{id:"",addr:""},group_place:{id:"",addr:""}},early:{start_time:"",end_time:"",hotel_id:"",hotel_name:"",adult2:"",adult3:"",adult4:""},delay:{start_time:"",end_time:"",hotel_id:"",hotel_name:"",adult2:"",adult3:"",adult4:""},additional:{}},onetour:{departing_date:"",product_id:$productId,adult:"1",child:"0",cost:"",price:"---",save:"---",traveling:{viewspots:[{package_id:"",viewspot:"",addr:""}]},normal:{package_id:""},optional:{packages:[{package_id:"",packageitem_id:"",addr:""}]},addrs:{pick_up:{id:"",addr:""},see_off:{id:"",addr:""},gather_place:{id:"",addr:""},group_place:{id:"",addr:""}},additional:{}},baoche:{product_id:$productId,adult:"1",child:"0",cost:"",price:"---",save:"---",baoche:{package_id:"",packages:0,childSeat:!1,overSeventy:!1,getonTime:"",getonPlace:"",getoffPlace:"",select:[]},additional:{}},normal:{departing_date:"",product_id:$productId,amount:"1",cost:"",price:"---",save:"---",normal:{package_id:""},additional:{}},normalperson:{departing_date:"",product_id:$productId,adult:"0",child:"0",cost:"",price:"---",save:"---",normal:{package_id:""},additional:{}},insurance:{product_id:$productId,price:"---",start_time:"",end_time:"",plan_guid:"",max_age:"",cost:"",amount:"1",additional:{}},aolidaytour:{getPrice:{productId:$productId,tripDate:"",aolidayId:$aolidayId},checkout:{product_id:$productId,tripDate:"",aolidayId:$aolidayId,no_cart:!0,cost:"",price:"---",save:"---",itemSpecParams:[]},itemSpecParams:{specId:"",itemPersonParams:[]},itemPersonParams:{}}},d={},l={getQueryString:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return null!=n?unescape(n[2]):null},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},clone:function(t){var e={};for(var n in t)e[n]=t[n];return e},emptyval:function(t){for(var e in t)"object"==typeof t[e]?l.emptyval(t[e]):t[e]=""},deleteKey:function(t){for(var e in t)"object"==typeof t[e]?l.deleteKey(t[e]):""==t[e]&&delete t[e]},emptyObject:function(t){for(var e in t)delete t[e]},delObjval:function(t,e){var n=t.split(",");return n.splice($.inArray(e,n),1),t=n.join(",")},delFristChar:function(t){return"0"===t.charAt(0)?t.substr(1,1):t},sortedData:function(t){t.forEach(function(t,e){var n=t.departing_date.split("-"),i=n[0];if(_innerMonth=l.delFristChar(n[1]),_innerDay=l.delFristChar(n[2]),d[i]||(d[i]={}),d[i][_innerMonth]||(d[i][_innerMonth]={}),d[i][_innerMonth][_innerDay]){var a=d[i][_innerMonth][_innerDay];d[i][_innerMonth][_innerDay]=a.price>t.price?t:a}else d[i][_innerMonth][_innerDay]=t})},checkDate:function(t){var e=new Date(t);_eleDateyear=e.getFullYear(),_eleDatemon=e.getMonth()+1,_eleDateday=e.getDate();var n=d[_eleDateyear]&&d[_eleDateyear][_eleDatemon]||{};return n[_eleDateday]&&n[_eleDateday].price||""},popUpScroll:function(t){var e=document.body.scrollTop||document.documentElement.scrollTop;$("."+t+" .title_top").parent().css("top",e+"px")}},s=function(){function t(t,e,n){$.post($commentClickGoodUrl,{comment_id:e,type:n},function(e){1==e.code&&t.next("em").text(e.data.useful)},"json")}if($(".booking-area").length){var o,r,c=$(".booking-area").offset().top;$(window).on("scroll",function(){o=$(".booking-area");var t=Math.floor($(document).scrollTop());r=$("#tour_plan_h").is(":hidden")?Math.floor($(".coupon-area").offset().top)-120:c+o.outerHeight(!0),c<=t&&t<r-70?(o.addClass("bar_fixed"),$(".showZkong").removeClass("hide")):($(".showZkong").addClass("hide"),o.removeClass("bar_fixed"))}),$(".to-book").on("click",function(t){t.preventDefault(),$("html, body").animate({scrollTop:$("#booking-cart").offset().top},1e3)})}if(l.getQueryString("from")&&setTimeout(function(){$(".toorder").trigger("click")},2e3),location.href.match(/item-\d+/g)){$.post($footPrintUrl,{no:$productNo},function(t){});var d=$.cookie("dm_currency");$(".needChangeCurrency").text("USD"===d?"$":"¥")}$(".flag-intro li").each(function(t,e){$(e).data("tag")&&$(e).hoverTips({contentHtml:$(e).data("tag")})}),$("span.collect").on("click",function(){var t=$(this);i.collect({contain:t,url:$collectUrl,product_id:$productId})}),$("span.compare").on("click",function(){var t=$(this);i.compare({contain:t,url:$compareUrl,no:$productNo})}),$("span.scan_code").hover(function(){$(".qrcode").show()},function(){$(".qrcode").hide()});var s=-1!==window.location.origin.indexOf("hydegroup")?"/pc/img/hyde/qrlogo.png":"/pc/img/common/dmlogo.png";$("#code").qrcode({width:120,height:120,src:s,text:location.href+"?mobile-PCQR"}),$(".send_email").on("click",function(){var t={url:$sendEmailUrl,action:"trips",no:$productNo};i.dmPubemail.init(t)});var p=$(".scroll_nav"),u=$(".scroll_con").children(".scroll-part");$daysNav=$(".day-container"),nav_scroll=new a.Nav,$daysNav.length?(days_Scroll=new a.Days,nav_scroll.init(p,u,function(){days_Scroll.init($daysNav)})):(days_Scroll=new a.Days,nav_scroll.init(p,u));var m=$("div.slideshow"),f=$("div.slideshow").find("ul.img-list"),h=$("div.slideshow").find("ul.img-list li");tab_carousel=new a.carousel({prev:"view-prev",next:"view-next",needimg:!0}),tab_carousel.init(m,f,h);var v=$("div.tour-brief-wrapper"),_=v.find("ul.tour-brief-list"),g=v.find("ul.tour-brief-list li");tourli_carousel=new a.carousel({prev:"brief-prev",next:"brief-next",hiddenWrap:"tour-brief-inner",step:8}),tourli_carousel.init(v,_,g);var y;$("div.sights").each(function(t,e){new a.carousel({prev:"dayimg-prev",next:"dayimg-next",step:5}).init($(e),$(e).find("ul.img-list"),$(e).find("ul.img-list li"))}),dmw.getTourinfo=function(t){$.get(t,function(t){$("div.tour_img_info").html(t).show()})},$("div.view_tour_info li.tour_imgli,div.view_tour_info span.viewspot").on("click",function(){var t=$(this).data("id");y=$(this);var e=$(this).parents(".daysTarget").attr("day-offset"),n=$tourimgUrl+"?viewspot_id="+t+"&trip_day="+e;$(".shadow-box").show(),dmw.getTourinfo(n)}),$("div.tour_img_info").on("click",".scenery_close",function(t){t.preventDefault(),$(".shadow-box").hide(),$("div.tour_img_info").hide()}),$("div.tour_img_info").on("click",".slide_btn",function(t){t.preventDefault();var e,n,i,a=$(this);i=y.parents(".daysTarget").attr("day-offset"),a.hasClass("slide_btn_prev")?y.prev().length?(e=y.prev().data("id"),y=y.prev(),n=$tourimgUrl+"?viewspot_id="+e+"&trip_day="+i,dmw.getTourinfo(n)):(e=y.parent().children().last().data("id"),y=y.parent().children().last(),n=$tourimgUrl+"?viewspot_id="+e+"&trip_day="+i,dmw.getTourinfo(n)):a.hasClass("slide_btn_next")&&(y.next().length?(e=y.next().data("id"),y=y.next(),n=$tourimgUrl+"?viewspot_id="+e+"&trip_day="+i,dmw.getTourinfo(n)):(e=y.parent().children().first().data("id"),y=y.parent().children().first(),n=$tourimgUrl+"?viewspot_id="+e+"&trip_day="+i,dmw.getTourinfo(n)))}),dmw.clickgood=function(){$(".gmFive").on("click",function(){var e=$(this).find(".gmFiveIcon"),n=e.data("id");e.hasClass("on")?(t(e,n,"desc"),e.removeClass("on")):(t(e,n,"plus"),e.addClass("on"))}),e(k)};var k={postUrl:$commentUrl,getParams:{product_id:$productId,option:""},pageBelong:"list",page:1,parentEle:"#tem_comment",tabs:".evaluate_tabs",pagination:"#pagination",callbackfunc:dmw.clickgood};e(k),n.listloadShow.init({wrapcon:"#tem_comment"}),$.when($.get($commentUrl,{product_id:$productId},function(t){$("#tem_comment").html(t)})).done(function(){dmw.clickgood()})}(),p={init:function(t){function e(t){var e=t.parents("form").serializeObject();for(var n in e)if((""==e[n]||0==e[n])&&"adult"!=n&&"child"!=n)return!1;return 0!=e.adult||0!=e.child}function i(e,n){if("insurance"==e.attr("data-type")){var i=e.serializeObject();i.end_time=void 0==i.start_time.split("/")[1]?"":i.start_time.split("/")[1],i.start_time=i.start_time.split("/")[0],t.additional[e.attr("data-id")]=i}else t.additional[e.attr("data-id")]=e.serializeObject();n&&dmw.getTotalPrice()}$.fn.serializeObject=function(){var t={},e=this.serializeArray();return $.each(e,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},$("div.combo-info input[type=checkbox]").on("change",function(){var e=$(this),a=(e.parents("tr").index(),{});a=e.parents("form").serializeObject();var o={closeBtn:!1,contentHtml:""};for(var r in a){if(!a[r]){switch(r){case"start_time":o.contentHtml="请选择日期",n.Walert(o);break;case"max_age":o.contentHtml="请先选择套餐",n.Walert(o)}return void e.removeAttr("checked")}if("adult"==r||"child"==r){if(!parseInt(a.adult)&&!parseInt(a.child))return o.contentHtml="请至少选择一名成人或儿童",n.Walert(o),void e.removeAttr("checked")}else if("amount"==r){if(!parseInt(a.amount))return o.contentHtml="请选择数量",n.Walert(o),void e.removeAttr("checked")}else if("package_id"==r&&!parseInt(a.package_id))return o.contentHtml="请选择套餐",n.Walert(o),void e.removeAttr("checked")}var c=e.parents("form").attr("data-price"),d=t.adult?parseInt(t.adult)+parseInt(t.child):parseInt(t.amount);d=0==d?1:d,e.is(":checked")?c&&(t.price=(Number(t.price)+Number(c)).toFixed(2),t.save=(Number(t.price)/d).toFixed(2)):c&&(t.price=(Number(t.price)-Number(c)).toFixed(2),t.save=(Number(t.price)/d).toFixed(2)),i(e.parents("form"),!1)}),$(".use-rangedate").each(function(t,n){$(n).pikaday({minDate:new Date,numberOfMonths:2,needRangeDate:!0,onClose:function(){$(n).parents("form").find("input[type=checkbox]");e($(n))&&i($(n).parents("form"),!0)}})}),$(".use-date").each(function(t,n){$(n).pikaday({minDate:new Date,onSelect:function(t){$(n).parents("form").find("input[type=checkbox]");e($(n))&&i($(n).parents("form"),!0)}})}),$("select[name=package_id],select[name=child],select[name=adult],select[name=amount],select[name=plan_guid]").on("change",function(){var t=$(this);t.parents("form").find("input[type=checkbox]");t.hasClass("isinsurance")&&t.parents("form").find("input[name=max_age]").val(t.find("option:selected").attr("data-maxage"));e(t)&&i(t.parents("form"),!0)})}},u=function(){$.when($.get("/product/_coupon.html",{no:$productNo},function(t){$("#coupon_contain").html(t)}),$.get("/product/_coupon.html",{no:$productNo,action:1},function(t){$(".flag-coupon").html(t)})).done(function(){nav_scroll.update(),$(".day-container").length&&days_Scroll.update(),function(){var t=$("#coupon_contain"),e=$(".flag-coupon"),i=$(".expandCoupon"),a=$(".coupon_list .section-activity");$(".coupon_list .section-activity ul").height()>340?i.show():(a.css({height:"auto",padding:"20px 20px 0px"}),i.hide()),e.on("click",function(e){e.preventDefault(),t.find(".couponDetialModal").removeClass("hide"),t.find(".maskFixed").removeClass("hide")}),t.on("click",".expandCoupon",function(t){t.preventDefault();var e=$(this);e.hasClass("on")?(e.removeClass("on"),$(".coupon_list .section-activity").css("height","390px"),e.html('<span> 更多优惠券<i class="iconfont icon-xialajiantou "></i></span>')):(e.addClass("on"),$(".coupon_list .section-activity").css("height","auto"),e.html('<span> 收起优惠券<i class="iconfont icon-shanglajiantou-"></i></span>'))}),t.on("click",".coupon_list .section-activity ul li .activityspread span",function(t){t.preventDefault();var e=$(this);e.hasClass("on")?(e.removeClass("on"),e.html('展开详细说明<i class="iconfont icon-xialajiantou"></i>'),e.parent().prev().find("span").css("height","22px")):(e.html('收起<i class="iconfont icon-shanglajiantou-"></i>'),e.addClass("on"),e.parent().prev().find("span").css("height","auto"))}),t.on("click",".section-inner",function(e){e.preventDefault(),t.find(".couponDetialModal").removeClass("hide"),t.find(".maskFixed").removeClass("hide")}),t.on("click",".closeIcon",function(t){t.preventDefault(),$(this),$(".couponDetialModal").addClass("hide"),$(".maskFixed").addClass("hide")}),t.on("click",".getStatus",function(t){t.preventDefault();var e=$(this),i={closeBtn:!1,contentHtml:""};$.post("/index/_receivecoupon.html",{no:e.data("no")},function(t){1==t.code?(n.Walert({flagicon:"icon-success",color:"#51c332",closeBtn:!1,contentHtml:t.info}),e.html('<span class="btn_coupon">成功领取</span>'),e.parents("li").addClass("hasreceived")):88==t.code?(i.contentHtml=t.info,n.Walert(i),setTimeout(function(){location="/login.html?ref="+location.pathname},2e3)):(i.contentHtml=t.info,n.Walert(i))},"json")})}()})}();return{$detailDate:c,$toolobj:l,$detailFunc:s,$extraFunc:p,$getCouponFunc:u}});